<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <script src="https://unpkg.com/htmx.org@2.0.4"
    integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
    crossorigin="anonymous"></script>
  <title>Análisis de Riesgo Crediticio</title>

  <script>
    // Auto-calculate total_pymnt_inv to match total_pymnt when total_pymnt changes
    function updateTotalPymntInv() {
      const totalPymnt = document.getElementById('total_pymnt').value;
      const totalPymntInv = document.getElementById('total_pymnt_inv');
      if (totalPymnt && !totalPymntInv.value) {
        totalPymntInv.value = totalPymnt;
      }
    }

    // Auto-calculate out_prncp_inv to match out_prncp when out_prncp changes
    function updateOutPrncpInv() {
      const outPrncp = document.getElementById('out_prncp').value;
      const outPrncpInv = document.getElementById('out_prncp_inv');
      if (outPrncp && !outPrncpInv.value) {
        outPrncpInv.value = outPrncp;
      }
    }

    // Add event listeners when page loads
    document.addEventListener('DOMContentLoaded', function () {
      document.getElementById('total_pymnt').addEventListener('input', updateTotalPymntInv);
      document.getElementById('out_prncp').addEventListener('input', updateOutPrncpInv);
    });
  </script>
</head>

<body class="bg-gradient-to-br from-slate-900 to-slate-700 min-h-screen flex flex-col">
  <!-- Header with UNAL logo -->
  <header class="text-white shadow-md">
    <div class="container mx-auto px-4 py-3 flex items-center justify-center">
      <div class="flex flex-row items-center space-x-2">
        <img src="https://unal.edu.co/_assets/ca8e1ca9a551c3e3ffc233b30e54ba93/images/escudoUnal.svg" class="h-20">
        <h1 class="text-xl font-bold">Análisis de Riesgo Crediticio</h1>
      </div>
    </div>
  </header>

  <!-- Main content -->
  <main class="flex-grow container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto rounded-xl shadow-lg overflow-hidden p-6 bg-slate-800">
      <h2 class="text-2xl font-bold text-center text-gray-100 mb-6">Predice tu Riesgo Crediticio</h2>

      <!-- Descripción de variables -->
      <div class="mb-8">
        <h3 class="text-lg font-semibold text-gray-200 mb-2">Descripción de las variables</h3>
        <div class="overflow-x-auto">
          <table class="min-w-full text-xs text-gray-100 bg-slate-700 rounded-lg">
            <thead>
              <tr>
                <th class="px-2 py-1 text-left">Variable</th>
                <th class="px-2 py-1 text-left">Descripción</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="px-2 py-1 font-mono">% principal pagado</td>
                <td class="px-2 py-1">Porcentaje del principal pagado (valor entre 0 y 1).</td>
              </tr>
              <tr>
                <td class="px-2 py-1 font-mono">Total principal recibido</td>
                <td class="px-2 py-1">Principal recibido a la fecha.</td>
              </tr>
              <tr>
                <td class="px-2 py-1 font-mono">Último pago</td>
                <td class="px-2 py-1">Monto del último pago recibido.</td>
              </tr>
              <tr>
                <td class="px-2 py-1 font-mono">Recuperaciones</td>
                <td class="px-2 py-1">Recuperaciones brutas después de incumplimiento.</td>
              </tr>
              <tr>
                <td class="px-2 py-1 font-mono">Total pagado</td>
                <td class="px-2 py-1">Pagos recibidos a la fecha para el monto total financiado.</td>
              </tr>
              <tr>
                <td class="px-2 py-1 font-mono">Total pagado por inversionistas</td>
                <td class="px-2 py-1">Pagos recibidos a la fecha para la parte financiada por inversionistas.</td>
              </tr>
              <tr>
                <td class="px-2 py-1 font-mono">Principal pendiente</td>
                <td class="px-2 py-1">Principal pendiente para el monto total financiado.</td>
              </tr>
              <tr>
                <td class="px-2 py-1 font-mono">Principal pendiente inversionistas</td>
                <td class="px-2 py-1">Principal pendiente para la parte financiada por inversionistas.</td>
              </tr>
              <tr>
                <td class="px-2 py-1 font-mono">Tasa de interés</td>
                <td class="px-2 py-1">Tasa de interés del préstamo (%).</td>
              </tr>
              <tr>
                <td class="px-2 py-1 font-mono">% término pagado</td>
                <td class="px-2 py-1">Porcentaje del término del préstamo pagado (valor entre 0 y 1).</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Form with HTMX -->
      <form hx-post="/analyze" hx-target="#result-container" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="pct_principal_paid" class="block text-sm font-medium text-gray-300">% Principal Pagado:</label>
            <input type="number" id="pct_principal_paid" name="pct_principal_paid" required step="0.01" min="0" max="1"
              placeholder="1.0"
              class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 bg-slate-700 text-gray-100 focus:outline-none focus:ring-sky-500 focus:border-sky-500">
            <p class="text-xs text-gray-400 mt-1">Valor entre 0 y 1 (ej: 0.8 = 80%)</p>
          </div>

          <div>
            <label for="total_rec_prncp" class="block text-sm font-medium text-gray-300">Total Principal Recibido
              (USD):</label>
            <input type="number" id="total_rec_prncp" name="total_rec_prncp" required min="0"
              placeholder="12000"
              class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 bg-slate-700 text-gray-100 focus:outline-none focus:ring-sky-500 focus:border-sky-500">
          </div>

          <div>
            <label for="last_pymnt_amnt" class="block text-sm font-medium text-gray-300">Último Pago (USD):</label>
            <input type="number" id="last_pymnt_amnt" name="last_pymnt_amnt" required min="0"
              placeholder="100"
              class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 bg-slate-700 text-gray-100 focus:outline-none focus:ring-sky-500 focus:border-sky-500">
          </div>

          <div>
            <label for="recoveries" class="block text-sm font-medium text-gray-300">Recuperaciones (USD):</label>
            <input type="number" id="recoveries" name="recoveries" required min="0" placeholder="0"
              class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 bg-slate-700 text-gray-100 focus:outline-none focus:ring-sky-500 focus:border-sky-500">
          </div>

          <div>
            <label for="total_pymnt" class="block text-sm font-medium text-gray-300">Total Pagado (USD):</label>
            <input type="number" id="total_pymnt" name="total_pymnt" required min="0" placeholder="13000"
              class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 bg-slate-700 text-gray-100 focus:outline-none focus:ring-sky-500 focus:border-sky-500">
          </div>

          <div>
            <label for="total_pymnt_inv" class="block text-sm font-medium text-gray-300">Total Pagado por Inversionistas
              (USD):</label>
            <input type="number" id="total_pymnt_inv" name="total_pymnt_inv" required min="0"
              placeholder="13000"
              class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 bg-slate-700 text-gray-100 focus:outline-none focus:ring-sky-500 focus:border-sky-500">
          </div>

          <div>
            <label for="out_prncp" class="block text-sm font-medium text-gray-300">Principal Pendiente (USD):</label>
            <input type="number" id="out_prncp" name="out_prncp" required placeholder="0"
              class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 bg-slate-700 text-gray-100 focus:outline-none focus:ring-sky-500 focus:border-sky-500">
          </div>

          <div>
            <label for="out_prncp_inv" class="block text-sm font-medium text-gray-300">Principal Pendiente
              Inversionistas (USD):</label>
            <input type="number" id="out_prncp_inv" name="out_prncp_inv" required placeholder="0"
              class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 bg-slate-700 text-gray-100 focus:outline-none focus:ring-sky-500 focus:border-sky-500">
          </div>

          <div>
            <label for="int_rate" class="block text-sm font-medium text-gray-300">Tasa de Interés (%):</label>
            <input type="number" id="int_rate" name="int_rate" required step="0.1" min="0" max="30" placeholder="10.0"
              class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 bg-slate-700 text-gray-100 focus:outline-none focus:ring-sky-500 focus:border-sky-500">
          </div>

          <div>
            <label for="pct_term_paid" class="block text-sm font-medium text-gray-300">% Término Pagado:</label>
            <input type="number" id="pct_term_paid" name="pct_term_paid" required step="0.01" min="0" max="1"
              placeholder="1.0"
              class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 bg-slate-700 text-gray-100 focus:outline-none focus:ring-sky-500 focus:border-sky-500">
            <p class="text-xs text-gray-400 mt-1">Valor entre 0 y 1 (ej: 0.2 = 20%)</p>
          </div>
        </div>

        <button type="submit"
          class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-sky-600 hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 focus:ring-offset-slate-800">
          Analizar Riesgo
        </button>
      </form>

      <!-- Results container - HTMX will update this area -->
      <div id="result-container" class="mt-6 p-4 border-t border-gray-700 text-gray-300">
        <!-- Los resultados aparecerán aquí -->
      </div>

      <!-- Learn more section -->
      <div class="mt-6 pt-6 border-t border-gray-700 text-center">
        <h3 class="text-sm font-medium text-gray-400">Conoce más sobre nuestro modelo de riesgo crediticio:</h3>
        <div class="mt-2 flex justify-center space-x-4">
          <a href="#" class="text-sky-400 hover:text-sky-300">
            Informe Técnico
          </a>
          <a href="#" class="text-sky-400 hover:text-sky-300">
            Guías Financieras
          </a>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="text-gray-300 py-6">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row items-center justify-center">
        <div class="text-center">
          <p class="text-sm">
            Aplicación de Análisis de Riesgo Crediticio -
            <script>document.write(new Date().toLocaleDateString());</script>
          </p>
          <p class="text-xs mt-2">Desarrollado por: Alejandro Feria - Universidad Nacional de Colombia</p>
        </div>
      </div>
    </div>
  </footer>
</body>

</html>